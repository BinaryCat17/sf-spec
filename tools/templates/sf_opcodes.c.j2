#include <sionflow/isa/sf_opcodes.h>
#include <sionflow/isa/sf_op_defs.h>
#include <stddef.h>
#include <stdbool.h>

/**
 * SionFlow Operation Metadata (Runtime)
 * Automatically generated from isa.json. DO NOT EDIT.
 */

const sf_op_metadata SF_OP_METADATA[SF_NODE_COUNT] = {
    [SF_NODE_UNKNOWN] = { "Unknown", 0, SF_OP_CAT_SPECIAL, SF_STRATEGY_DEFAULT, 0, 0, SF_ACCESS_SPECIAL, {NULL, NULL, NULL, NULL}, 0 },
{% for node in nodes %}
    [SF_NODE_{{ node.id }}] = {
        "{{ node.name | default(node.id) }}",
        SF_OP_{{ node.effective_opcode }},
        SF_OP_CAT_{{ node.category | default('special') | upper }},
        SF_STRATEGY_{{ node.strategy | default('default') | upper }},
        {{ mask_bitfields[node.inputs[0].mask if node.inputs else 'all'] | default(65535) }},
        SF_OUT_{{ node.type_rule | default('same_as_input') | upper }},
        SF_ACCESS_{{ node.access | default('linear') | upper }},
        {
            {%- for i in range(4) -%}
            {%- if i < node.inputs|length -%}"{{ node.inputs[i].name }}"{%- else -%}NULL{%- endif -%}
            {%- if i < 3 -%}, {% endif -%}
            {%- endfor -%}
        },
        {% set cflags = node.get('flags', []) -%}
        {% if cflags -%}
            {%- for f in cflags -%}SF_OP_FLAG_{{ f }}{%- if not loop.last %} | {% endif -%}{%- endfor -%}
        {%- else -%}
            0
        {%- endif %}
    },
{%- endfor %}
};

const char* sf_opcode_to_str(u16 opcode) {
    for (int i = 0; i < SF_NODE_COUNT; ++i) {
        if (SF_OP_METADATA[i].opcode == opcode && SF_OP_METADATA[i].opcode != SF_OP_NOOP) {
            return SF_OP_METADATA[i].name;
        }
    }
    return "UNKNOWN";
}

const sf_op_metadata* sf_get_op_metadata(u16 opcode) {
    for (int i = 0; i < SF_NODE_COUNT; ++i) {
        if (SF_OP_METADATA[i].opcode == opcode && SF_OP_METADATA[i].opcode != SF_OP_NOOP) {
            return &SF_OP_METADATA[i];
        }
    }
    return NULL;
}